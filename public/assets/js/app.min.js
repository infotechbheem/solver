var APP;

(APP = new (APP = function () {
    this.ASSETS_PATH = "./assets/";
    this.SERVER_PATH = this.ASSETS_PATH + "demo/server/";
    this.is_touch_device = function () {
        return !!("ontouchstart" in window) || !!("onmsgesturechange" in window);
    };
})).UI = { scrollTop: 0 };

// Preloader and animation on load
$(window).on("load", function () {
    setTimeout(function () {
        $(".preloader-backdrop").fadeOut(200);
        $("body").addClass("has-animation");
    }, 0);
});

// Add sidebar-mini class on load, resize, and scroll if width < 992
// $(window).on("load resize scroll", function () {
//     if ($(this).width() < 992) {
//         $("body").addClass("sidebar-mini");
//     }
// });

$(function () {
    // ESC key handler for fullscreen mode
    function escHandler(e) {
        if (e.which === 27) {
            $("body").removeClass("fullscreen-mode");
            $(".ibox-fullscreen").removeClass("ibox-fullscreen");
            $(window).off("keydown", escHandler);
        }
    }

    // Initialize metisMenu
    $(".metismenu").metisMenu();

    // Initialize tooltips and popovers
    $('[data-toggle="tooltip"]').tooltip();
    $('[data-toggle="popover"]').popover();

    // Initialize slimScroll for elements with class 'scroller'
    $(".scroller").each(function () {
        $(this).slimScroll({
            height: $(this).attr("data-height"),
            color: $(this).attr("data-color"),
            railOpacity: "0.9"
        });
    });

    // Theme config toggle
    $(".theme-config-toggle").on("click", function () {
        $(this).parents(".theme-config").toggleClass("opened");
    });

    // Sidebar toggler
    $(".js-sidebar-toggler").click(function () {
        $("body").toggleClass("sidebar-mini");
    });

    // Fixed layout toggle
    $("#_fixedlayout").change(function () {
        if ($(this).is(":checked")) {
            $("body").addClass("fixed-layout");
            $("#sidebar-collapse").slimScroll({
                height: "100%",
                railOpacity: "0.9"
            });
        } else {
            $("#sidebar-collapse").slimScroll({ destroy: true }).css({
                overflow: "visible",
                height: "auto"
            });
            $("body").removeClass("fixed-layout");
        }
    });

    // Fixed navbar toggle
    $("#_fixedNavbar").change(function () {
        $(this).is(":checked")
            ? $("body").addClass("fixed-navbar")
            : $("body").removeClass("fixed-navbar");
    });

    // Layout style change
    $("[name='layout-style']").change(function () {
        +$(this).val()
            ? $("body").addClass("boxed-layout")
            : $("body").removeClass("boxed-layout");
    });

    // Theme skin change
    $(".color-skin-box input:radio").change(function () {
        var theme = $(this).val();
        if (theme !== "default") {
            if ($("#theme-style").length) {
                $("#theme-style").attr("href", "assets/css/themes/" + theme + ".css");
            } else {
                $("head").append(
                    "<link href='assets/css/themes/" + theme + ".css' rel='stylesheet' id='theme-style'>"
                );
            }
        } else {
            $("#theme-style").remove();
        }
    });

    // Show 'to-top' button on scroll
    $(window).scroll(function () {
        $(this).scrollTop() > APP.UI.scrollTop
            ? $(".to-top").fadeIn()
            : $(".to-top").fadeOut();
    });

    // Scroll to top button click
    $(".to-top").click(function () {
        $("html, body").animate({ scrollTop: 0 }, 500);
    });

    // Collapse ibox
    $(".ibox-collapse").click(function () {
        $(this).closest("div.ibox").toggleClass("collapsed-mode").children(".ibox-body").slideToggle(200);
    });

    // Remove ibox
    $(".ibox-remove").click(function () {
        $(this).closest("div.ibox").remove();
    });

    // Fullscreen ibox toggle
    $(".fullscreen-link").click(function () {
        if ($("body").hasClass("fullscreen-mode")) {
            $("body").removeClass("fullscreen-mode");
            $(this).closest("div.ibox").removeClass("ibox-fullscreen");
            $(window).off("keydown", escHandler);
        } else {
            $("body").addClass("fullscreen-mode");
            $(this).closest("div.ibox").addClass("ibox-fullscreen");
            $(window).on("keydown", escHandler);
        }
    });

    // Backdrop toggle function
    $.fn.backdrop = function () {
        $(this).toggleClass("shined");
        $("body").toggleClass("has-backdrop");
        return $(this);
    };

    // Backdrop click event
    $(".backdrop").click(function () {
        $("body").removeClass("has-backdrop");
        $(".shined").removeClass("shined");
    });
});

// Timepicker defaults
$(function () {
    if ($.fn.timepicker) {
        $.fn.timepicker.defaults = $.extend(true, {}, $.fn.timepicker.defaults, {
            icons: {
                up: "fa fa-angle-up",
                down: "fa fa-angle-down"
            }
        });
    }
});
